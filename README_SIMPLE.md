# Simple Hybrid Pair Programming System

超シンプル版 - ClaudeCode + DeepSeek 協調開発システム ✨ **チャンク処理対応版**

## 🎯 概要

元の複雑なシステム（15+ファイル）を1ファイル（240行）に簡略化。
核心機能のみを残して、実用性と理解しやすさを重視。

## ⚡ NEW: チャンク処理機能

### 🚀 自動フォールバック処理
1. **通常処理**: まず一括でAPI呼び出し
2. **チャンク処理**: 失敗時に自動で分割処理に切り替え
3. **インテリジェントマージ**: 複数結果を自動統合

### 📦 チャンク処理の特徴
- **自動分割**: 長いプロンプトを60%サイズで分割
- **適応タイムアウト**: チャンクごとにタイムアウト延長
- **シンプルマージ**: コードブロック結合、重複除去
- **進捗表示**: 各チャンクの処理状況を表示

## ⚡ クイックスタート

```bash
# 1. システム実行
python simple_hybrid.py

# 2. タスク作成
> create large_system "大規模データ分析システム"

# 3. タスク承認 
> approve <task_id>

# 4. 実行（自動でチャンク処理対応）
> run <task_id>
```

## 🔧 必要な設定

### LM Studio設定
1. [LM Studio](https://lmstudio.ai/) をダウンロード・起動
2. DeepSeek-Coder 6.7B GGUF モデルを読み込み
3. ローカルAPIサーバー起動 (http://localhost:1234)

### Python依存関係
```bash
pip install requests
```

### 設定ファイル
初回実行時に `simple_config.json` が自動作成されます。

## 🏗️ アーキテクチャ

### ファイル構成
```
simple_hybrid.py    # メインプログラム（チャンク処理対応）
simple_config.json  # 設定ファイル（自動生成）  
simple_tasks.json   # タスク保存（自動生成）
simple_results/     # 生成コード保存ディレクトリ
```

### 新機能追加
```python
class SimpleHybridPair:
    # 既存機能
    def create_task()      # タスク作成
    def list_tasks()       # 一覧表示
    def approve_task()     # 承認
    def run_workflow()     # ワークフロー実行
    
    # 新機能：チャンク処理
    def _make_api_request()    # 単一API呼び出し
    def _chunk_prompt()        # プロンプト分割
    def _merge_responses()     # 結果統合
    def call_deepseek()        # メイン処理（自動フォールバック）
```

## 🚀 使用方法

### 基本コマンド
```bash
create <タイトル> <説明>  # 新規タスク作成
list                     # タスク一覧表示
approve <ID>             # タスク承認
run <ID>                 # ワークフロー実行（チャンク対応）
exit                     # 終了
```

### チャンク処理の動作例
```
🤖 DeepSeek API呼び出し開始
API呼び出し中... (試行1, タイムアウト60秒)
⏰ タイムアウト (60秒経過) - 長いプロンプトの可能性
⚠️ 通常処理が失敗、チャンク処理を開始...
📦 プロンプトを3チャンクに分割 (各チャンク約20行)
📝 チャンク1/3を処理中...
✅ チャンク1完了
📝 チャンク2/3を処理中...
✅ チャンク2完了
📝 チャンク3/3を処理中...
✅ チャンク3完了
🔗 3チャンクを結合完了: 1247文字
✅ 完了! 結果: simple_results/abc123de_20240906_143022.py
```

## 🔍 Complete版との比較

| 項目 | Simple版 | Complete版 |
|------|----------|------------|
| ファイル数 | 1ファイル | 15+ファイル |
| 行数 | 240行 | 2000+行 |
| チャンク処理 | ✅ 軽量実装 | ✅ 高機能実装 |
| 再接続 | ❌ 基本対応 | ✅ 完全対応 |
| 学習コスト | 低（5分） | 高（1時間+） |
| 複雑タスク対応 | ✅ チャンク分割 | ✅ 完全対応 |

## ✅ メリット

- **理解しやすい**: 全機能が1ファイルで見渡せる
- **導入簡単**: 依存関係最小限、設定自動生成
- **高速動作**: オーバーヘッドなし
- **大規模対応**: チャンク処理で長大なタスクにも対応
- **自動フォールバック**: 失敗時の自動切り替え
- **拡張容易**: 必要な機能だけ追加可能

## 🔧 カスタマイズ

### チャンク処理設定
コード内で簡単に調整可能：
```python
# チャンクサイズ調整（現在60%）
chunk_size = max(10, int(total_lines * 0.6))  # 60%を変更

# タイムアウト調整
timeout = 60 + (attempt * 30)  # 基本60秒 + 30秒ずつ延長
```

### API設定変更
`simple_config.json` を編集:
```json
{
  "deepseek_api": {
    "endpoint": "http://localhost:1234/v1/chat/completions",
    "model": "your-model-name", 
    "temperature": 0.2,
    "max_tokens": 2000
  }
}
```

## 🎉 実用例

```bash
# 大規模システムの実装例
> create data_pipeline "CSVファイル読み込み、データ変換、SQLite保存、統計分析、グラフ出力機能"
> approve f3a1b2c4
> run f3a1b2c4

# チャンク処理が自動実行され、複数ファイルの結果が生成される
# → simple_results/f3a1b2c4_20240906_143022.py が生成
```

## 🆕 Version 2.0 Features

- ✅ **自動チャンク分割**: 長大なプロンプトを自動分割
- ✅ **適応的タイムアウト**: 処理時間に応じてタイムアウト調整
- ✅ **インテリジェントマージ**: 複数結果の自動統合
- ✅ **進捗可視化**: 処理状況の詳細表示
- ✅ **絵文字進捗**: わかりやすい視覚的フィードバック

**シンプルでも強力な協調開発を、チャンク処理対応でさらにパワフルに！** 🚀